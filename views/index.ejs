<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In√≠cio - CineApp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/index_style.css">
</head>
<body>

    <nav>
        <a href="/" class="logo">CinePIS</a>
        
        <form action="/search" method="GET" class="search-box">
            <input type="text" name="q" placeholder="Pesquisar filmes, atores...">
        </form>

        <div class="auth-links">
            <% if (typeof user !== 'undefined' && user) { %>
                <a href="/auth/perfil" class="user-profile">
                    <i class="fa-solid fa-circle-user user-icon"></i>
                    <span style="font-weight: bold; color: white;"><%= user.nome_utilizador %></span>
                </a>
                <a href="/auth/logout" style="color:#e21c3c; font-weight:bold;">
                    <i class="fa-solid fa-right-from-bracket"></i> Sair
                </a>
            <% } else { %>
                <a href="/auth/login">Entrar</a>
                <a href="/auth/register" style="background: #f5c518; color: black; padding: 8px 15px; border-radius: 5px; font-weight: bold;">Registar</a>
            <% } %>
        </div>
    </nav>

    <div class="filter-bar">
        <form action="/filter" method="GET">
            <select name="genre" class="genre-select" onchange="this.form.submit()">
                <option value="">Todos os G√©neros</option>
                <% if (typeof genres !== 'undefined') { %>
                    <% genres.forEach(g => { %>
                        <option value="<%= g.id %>" <%= selectedGenre == g.id ? 'selected' : '' %>>
                            <%= g.name %>
                        </option>
                    <% }) %>
                <% } %>
            </select>
        </form>
    </div>

    <% if (isSearch) { %>
        
        <div class="category-title">
            <% if (selectedGenre && typeof genres !== 'undefined') { %>
                <% const gName = genres.find(g => g.id == selectedGenre)?.name || 'Filtro'; %>
                üìÇ Filmes de <%= gName %>
            <% } else { %>
                üîç Resultados da Pesquisa
            <% } %>
        </div>

        <div class="movie-grid">
            <% if (movies.length > 0) { %>
                <% movies.forEach(movie => { %>
                    <a href="/details/<%= movie.media_type || 'movie' %>/<%= movie.id %>" class="movie-card">
                        <% if (movie.poster_path) { %>
                            <img src="<%= imageBaseUrl + movie.poster_path %>" alt="<%= movie.title || movie.name %>">
                        <% } else { %>
                            <img src="https://via.placeholder.com/160x240?text=Sem+Imagem" alt="Sem Imagem">
                        <% } %>
                        <div class="movie-info"><%= movie.title || movie.name %></div>
                        <div class="rating">‚òÖ <%= movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A' %></div>
                    </a>
                <% }) %>
            <% } else { %>
                <p style="padding-left: 40px;">Nenhum resultado encontrado.</p>
            <% } %>
        </div>

    <% } else { %>

        <div class="category-title">üî• Tend√™ncias de Hoje</div>
        <div class="movie-row">
            <% if (typeof trendingMovies !== 'undefined') { %>
                <% trendingMovies.forEach(movie => { %>
                    <a href="/details/<%= movie.media_type || 'movie' %>/<%= movie.id %>" class="movie-card">
                        <% if (movie.poster_path) { %>
                            <img src="<%= imageBaseUrl + movie.poster_path %>" alt="<%= movie.title || movie.name %>">
                        <% } else { %> 
                            <img src="https://via.placeholder.com/160x240" alt="Sem Imagem"> 
                        <% } %>
                        <div class="movie-info"><%= movie.title || movie.name %></div>
                        <div class="rating">‚òÖ <%= movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A' %></div>
                    </a>
                <% }) %>
            <% } %>
        </div>

        <div class="category-title">üçø Filmes Populares</div>
        <div class="movie-row">
            <% if (typeof popularMovies !== 'undefined') { %>
                <% popularMovies.forEach(movie => { %>
                    <a href="/details/movie/<%= movie.id %>" class="movie-card">
                        <% if (movie.poster_path) { %>
                            <img src="<%= imageBaseUrl + movie.poster_path %>" alt="<%= movie.title %>">
                        <% } %>
                        <div class="movie-info"><%= movie.title %></div>
                        <div class="rating">‚òÖ <%= movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A' %></div>
                    </a>
                <% }) %>
            <% } %>
        </div>

        <div class="category-title">‚≠ê Aclamados pela Cr√≠tica</div>
        <div class="movie-row">
            <% if (typeof topRatedMovies !== 'undefined') { %>
                <% topRatedMovies.forEach(movie => { %>
                    <a href="/details/movie/<%= movie.id %>" class="movie-card">
                        <% if (movie.poster_path) { %>
                            <img src="<%= imageBaseUrl + movie.poster_path %>" alt="<%= movie.title %>">
                        <% } %>
                        <div class="movie-info"><%= movie.title %></div>
                        <div class="rating">‚òÖ <%= movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A' %></div>
                    </a>
                <% }) %>
            <% } %>
        </div>

        <div class="category-title" style="margin-top: 60px; border-color: #fff;">üé¨ Descobrir Mais Filmes</div>
        <div class="movie-grid">
            <% if (typeof discoveryMovies !== 'undefined') { %>
                <% discoveryMovies.forEach(movie => { %>
                    <a href="/details/movie/<%= movie.id %>" class="movie-card">
                        <% if (movie.poster_path) { %>
                            <img src="<%= imageBaseUrl + movie.poster_path %>" alt="<%= movie.title %>">
                        <% } else { %>
                            <img src="https://via.placeholder.com/160x240?text=Sem+Imagem" alt="Sem Imagem">
                        <% } %>
                        <div class="movie-info"><%= movie.title %></div>
                        <div class="rating">‚òÖ <%= movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A' %></div>
                    </a>
                <% }) %>
            <% } else { %>
                <p style="padding-left: 40px;">A carregar filmes...</p>
            <% } %>
        </div>

        <div class="category-title" style="margin-top: 60px; border-color: #fff;">üì∫ Descobrir Mais S√©ries</div>
        <div class="movie-grid">
            <% if (typeof discoveryTV !== 'undefined') { %>
                <% discoveryTV.forEach(tv => { %>
                    <a href="/details/tv/<%= tv.id %>" class="movie-card">
                        <% if (tv.poster_path) { %>
                            <img src="<%= imageBaseUrl + tv.poster_path %>" alt="<%= tv.name %>">
                        <% } else { %>
                            <img src="https://via.placeholder.com/160x240?text=Sem+Imagem" alt="Sem Imagem">
                        <% } %>
                        <div class="movie-info"><%= tv.name %></div>
                        <div class="rating">‚òÖ <%= tv.vote_average ? tv.vote_average.toFixed(1) : 'N/A' %></div>
                    </a>
                <% }) %>
            <% } else { %>
                <p style="padding-left: 40px;">A carregar s√©ries...</p>
            <% } %>
        </div>

    <% } %>

</body>
</html>